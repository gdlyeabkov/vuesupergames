<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        .card-body{
            overflow: hidden;
            max-height: 200px;            
        }

        .customcard {
            width:calc(100% / 6);
            display: block;
            float:left;
        }
        .aside {
            background-color: rgb(235, 235, 235);
            width: 20%;
        }
        .main {
            background-color: rgb(205, 209, 206);
            width: 80%;
        }
        .main, .aside {
            min-height: 500px;
            float: left;
        }
        
        .searchText{
            width: 500px;
        }
    </style>
</head>
<body>
    <!-- header -->
    <%- include('./includes/header.ejs') %>
    
    <%- include('./includes/aside.ejs') %>

    <div class="main">
        <h1>Самые популярные игры: </h1>
        <% if(allGames.length >= 1) { %>
            <% allGames.forEach(function(game) { %>
                <% if(game.genre.includes("popular")){ %>
                    <div class="card customcard">
                        <h5 class="card-header">
                            <% if (game.imageurl.includes('empty')) { %>  
                                <img width="85px" height="85px" src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png" />
                            <%} else if (!game.imageurl.includes('empty')) { %>
                                <img width="85px" height="85px" src="<%= game.imageurl %>" />
                            <% } %>
                        </h5>
                        <div class="card-body">
                            <a href="/game?gameid=<%= game._id %>&touser=<%= touser %>"><%= game.name %></a>
                            <p href="/"><%= game.description %></p>
                            <p href="/"><%= game.likes %></p>
                            <% [ 1, 2, 3, 4, 5 ].map(function(star, starIndex) { %>
                                <% if (starIndex < game.likes) { %>
                                    <span style="color:black;" class="material-icons">
                                        star_rate
                                    </span>
                                <% } else { %>
                                    <span style="color:grey;" class="material-icons">
                                        star_rate
                                    </span>
                                <% } %>
                            <% }) %>
                            <% if(game.free.includes("false")) { %>
                                <p class="card-title"><%= game.cost %>$</p>
                            <% } else { %>
                                <p class="card-title">free</p>
                            <% } %>
                        </div> 
                    </div>
                <% } %>
            <% }); %>
        <% } else {%>
            <p>Нет опубликованных игр</p>    
        <% } %>
        <br style="clear:both;"/>

        <h1>Аркады: </h1>
        <% if(allGames.length >= 1) { %>
            <% allGames.forEach(function(game) { %>
                <% if(game.genre.includes("arcade")){ %>
                    <div class="card customcard">
                        <h5 class="card-header">
                            <% if (game.imageurl.includes('empty')) { %>  
                                <img width="85px" height="85px" src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png" />
                            <%} else if (!game.imageurl.includes('empty')) { %>
                                <img width="85px" height="85px" src="<%= game.imageurl %>" />
                            <% } %>
                        </h5>
                        <div class="card-body">
                            <a href="/game?gameid=<%= game._id %>&touser=<%= touser %>"><%= game.name %></a>
                            <p href="/"><%= game.description %></p>
                            <p href="/"><%= game.likes %></p>
                            <% [ 1, 2, 3, 4, 5 ].map(function(star, starIndex) { %>
                                <% if (starIndex < game.likes) { %>
                                    <span style="color:black;" class="material-icons">
                                        star_rate
                                    </span>
                                <% } else { %>
                                    <span style="color:grey;" class="material-icons">
                                        star_rate
                                    </span>
                                <% } %>
                            <% }) %>
                            <% if(game.free.includes("false")) { %>
                                <p class="card-title"><%= game.cost %>$</p>
                            <% } else { %>
                                <p class="card-title">free</p>
                            <% } %>
                        </div> 
                    </div>
                <% } %>
            <% }); %>
        <% } else {%>
            <p>Нет опубликованных игр</p>    
        <% } %>
        <br style="clear:both;"/>

        <h1>Квесты: </h1>
        <% if(allGames.length >= 1) { %>
            <% allGames.forEach(function(game) { %>
                <% if(game.genre.includes("quest")){ %>
                    <div class="card customcard">
                        <h5 class="card-header">
                            <% if (game.imageurl.includes('empty')) { %>  
                                <img width="85px" height="85px" src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png" />
                            <%} else if (!game.imageurl.includes('empty')) { %>
                                <img width="85px" height="85px" src="<%= game.imageurl %>" />
                            <% } %>
                        </h5>
                        <div class="card-body">
                            <a href="/game?gameid=<%= game._id %>&touser=<%= touser %>"><%= game.name %></a>
                            <p href="/"><%= game.description %></p>
                            <p href="/"><%= game.likes %></p>
                            <% [ 1, 2, 3, 4, 5 ].map(function(star, starIndex) { %>
                                <% if (starIndex < game.likes) { %>
                                    <span style="color:black;" class="material-icons">
                                        star_rate
                                    </span>
                                <% } else { %>
                                    <span style="color:grey;" class="material-icons">
                                        star_rate
                                    </span>
                                <% } %>
                            <% }) %>
                            <% if(game.free.includes("false")) { %>
                                <p class="card-title"><%= game.cost %>$</p>
                            <% } else { %>
                                <p class="card-title">free</p>
                            <% } %>
                        </div> 
                    </div>
                <% } %>
            <% }); %>
        <% } else {%>
            <p>Нет опубликованных игр</p>    
        <% } %>
        <br style="clear:both;"/>

        <h1>Match-3: </h1>
        <% if(allGames.length >= 1) { %>
            <% allGames.forEach(function(game) { %>
                <% if(game.genre.includes("match")){ %>
                    <div class="card customcard">
                        <h5 class="card-header">
                            <% if (game.imageurl.includes('empty')) { %>  
                                <img width="85px" height="85px" src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png" />
                            <%} else if (!game.imageurl.includes('empty')) { %>
                                <img width="85px" height="85px" src="<%= game.imageurl %>" />
                            <% } %>
                        </h5>
                        <div class="card-body">
                            <a href="/game?gameid=<%= game._id %>&touser=<%= touser %>"><%= game.name %></a>
                            <p href="/"><%= game.description %></p>
                            <p href="/"><%= game.likes %></p>
                            <% [ 1, 2, 3, 4, 5 ].map(function(star, starIndex) { %>
                                <% if (starIndex < game.likes) { %>
                                    <span style="color:black;" class="material-icons">
                                        star_rate
                                    </span>
                                <% } else { %>
                                    <span style="color:grey;" class="material-icons">
                                        star_rate
                                    </span>
                                <% } %>
                            <% }) %>
                            <% if(game.free.includes("false")) { %>
                                <p class="card-title"><%= game.cost %>$</p>
                            <% } else { %>
                                <p class="card-title">free</p>
                            <% } %>
                        </div> 
                    </div>
                <% } %>
            <% }); %>
        <% } else {%>
            <p>Нет опубликованных игр</p>    
        <% } %>
        
    </div>
    <!-- footer -->
    <%- include("./includes/footer.ejs") %>
    <script>
        document.querySelector('.customSearch').addEventListener('click', ()=>{

            let searchText = document.querySelector('.searchText').value
            let touser = document.querySelector('.customProfile').textContent.trim();
            
            if(searchText.trim().length >= 1){
                location.href = `/?auth=true&touser=${touser}&searchText=${searchText}`
            } else if(searchText.trim().length == 0){
                location.href = `/?auth=true&touser=${touser}&searchText=none`
            }
        })
    </script>
</body>
</html>